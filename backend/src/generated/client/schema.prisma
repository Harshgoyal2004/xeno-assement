generator client {
  provider   = "prisma-client-js"
  output     = "../src/generated/client"
  engineType = "library"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Tenant {
  id            String     @id @default(uuid())
  name          String
  shopifyDomain String     @unique
  accessToken   String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  customers     Customer[]
  products      Product[]
  orders        Order[]
}

model Customer {
  id          String  @id @default(uuid())
  shopifyId   String // BigInt in Shopify, but String is safer for JS
  email       String?
  firstName   String?
  lastName    String?
  totalSpent  Float   @default(0.0)
  ordersCount Int     @default(0)
  tenantId    String
  tenant      Tenant  @relation(fields: [tenantId], references: [id])
  orders      Order[]

  @@unique([shopifyId, tenantId])
}

model Product {
  id        String @id @default(uuid())
  shopifyId String
  title     String
  price     Float
  tenantId  String
  tenant    Tenant @relation(fields: [tenantId], references: [id])

  @@unique([shopifyId, tenantId])
}

model Order {
  id         String    @id @default(uuid())
  shopifyId  String
  totalPrice Float
  currency   String
  createdAt  DateTime
  tenantId   String
  tenant     Tenant    @relation(fields: [tenantId], references: [id])
  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  @@unique([shopifyId, tenantId])
}
